# Python Mastery

## : Beginner Grid-3

DJANGO Framework

### First Django project

```bash
$ pipenv install django
# activate the VENV
#To activate this project's virtualenv, run pipenv shell.
#Alternatively, run a command inside the virtualenv with pipenv run.
$ pipenv shell
```

Now the VENV is active we need to create the django project.

```bash
Alexandros-MacBook-Pro:vidly alexandrodisla$ pipenv shell
Launching subshell in virtual environmentâ€¦
 . /Users/alexandrodisla/.local/share/virtualenvs/vidly-xhLcunrD/bin/activate
bash-3.2$  . /Users/alexandrodisla/.local/share/virtualenvs/vidly-xhLcunrD/bin/activate
(vidly) bash-3.2$ django-admin startproject vidly .
```

Create a boiler plate file system in our directory to start our project.

#### IMportant

Set the vscode pythonPath to path of the virtual environment.

#### Start Server (default port)

```bash
 python3 manage.py runserver
```

### First App

**The django app can be breakdown into multiple small apps handeling a specific functionality.**

```bash
(vidly) Alexandros-MacBook-Pro:vidly alexandrodisla$ python3 manage.py startapp movies
```

### Views

Classic Pattern :

- MVC

Django pattern:

- MTV

#### SHow : "Hello World"

> In the movies app `((vidly) Alexandros-MacBook-Pro:vidly alexandrodisla$ python3 manage.py startapp movies)`:

1. we work in the views.py
2. we created urls.py inside the directory

- movies/views

```python
from django.http import HttpResponse
from django.shortcuts import render

# Create your views here.


def index(request):
    return HttpResponse("Hello World")

# create a urls.py to mapp this index
```

- movies/urls (created)

```python
from django.urls import path
from . import views
urlpatterns = [
    path('', views.index, name='index')
]
```

> WE go out the movies directory, (inside the vidly`_djangcreated_dir`)

- vidly/vidly/urls

```python
"""vidly URL Configuration

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/2.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('movies/', include('movies.urls'))
]
```

### Models

The model is supposed to map our database tables.

** `django.db //=> models` is the class doing the magic.**

- Movies/models

```python
from django.db import models

# Create your models here.


class Genre(models.Model):
    # use field
    name = models.CharField(max_length=255)


class Movie(models.Model):
    # use field
    title = models.CharField(max_length=255)
    release_year = models.IntegerField()
    number_in_stock = models.IntegerField()
    daily_rate = models.FloatField()
    # association has-many and belongs to
    # on delete will tell django how to handle
    # a delete event of a genre given the
    # association
    genre = models.ForeignKey(Genre, on_delete=models.CASCADE)
```

### Migrations

```bash
(venv)bash3.2$ python3 manage.py makemigrations
```

#### Step 1

Before we must register our movies app inside django:

- `Movies/apps.py` := we need `MoviesConfig` class.
- `vidly/settings.py` := put it this class here.

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'movies.apps.MoviesConfig' # Movie (created)
]
```

Django will keep track of our migrations.

WHat is INSIDE:

- Movies/apps

```python
from django.apps import AppConfig


class MoviesConfig(AppConfig):
    name = 'movies'
```

##### migration

```bash
(vidly) bash-3.2$ python3 manage.py makemigrations
Migrations for 'movies':
  movies/migrations/0001_initial.py
    - Create model Genre
    - Create model Movie
```

Now The migration will be valid:

- movies/migrations/0001_initial.py (created)

```python
# Generated by Django 2.2.4 on 2019-08-05 20:35

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Genre',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
            ],
        ),
        migrations.CreateModel(
            name='Movie',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('release_year', models.IntegerField()),
                ('number_in_stock', models.IntegerField()),
                ('daily_rate', models.FloatField()),
                ('genre', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='movies.Genre')),
            ],
        ),
    ]
```

We need to run the migration NOw

#### Step 2

```bash
(vidly) bash-3.2$ python3 manage.py migrate
```

### Changing the Models

We are adding a `date_created` column to our models `movies/models`

```python
from django.db import models
from django.utils import timezone
# Create your models here.


class Genre(models.Model):
    # use field
    name = models.CharField(max_length=255)


class Movie(models.Model):
    # use field
    title = models.CharField(max_length=255)
    release_year = models.IntegerField()
    number_in_stock = models.IntegerField()
    daily_rate = models.FloatField()
    # association has-many and belongs to
    # on delete will tell django how to handle
    # a delete event of a genre given the
    genre = models.ForeignKey(Genre, on_delete=models.CASCADE)
    # New
    date_created = models.DateTimeField(default=timezone.now)

```

Create a migration.

```bash
(vidly) bash-3.2$ python3 manage.py makemigrations
Migrations for 'movies':
  movies/migrations/0002_movie_date_created.py
    - Add field date_created to movie
```

`movies/migrations/0002_movie_date_created (create)`

```python
# Generated by Django 2.2.4 on 2019-08-06 14:01

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('movies', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='movie',
            name='date_created',
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
    ]
```

> The app is already registered

```python
(vidly) bash-3.2$ python3 manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, movies, sessions
Running migrations:
  Applying movies.0002_movie_date_created... OK
```

#### See the sql statements (if you want)

```bash
# see the sql statement of the first migration
(vidly) bash-3.2$ python3 manage.py sqlmigrate movies 0001
```

### Admin

We are going to take advantage of the powerful administration interface.

```bash
python3 manage.py runserver
```

As we can see we have an admin panel (application) that is avalaible to us.

WHY?

`vidly/vidly/setting.py`

we have, besides the movies app that we registered earlier, an admin and auth apps.

```python
(..)
# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'movies.apps.MoviesConfig'
]
(..)
```

To implement users into our application, We will need a **super user**.

```bash
(vidly)bash3.2$ python3 manage.py createsuperuser
```

Then enter valid credentials

```bash
(vidly) bash-3.2$ python3 manage.py createsuperuser
Username (leave blank to use 'alexandrodisla'): alexandro
Email address: alexandrodisla@hotmail.com
Password:
Password (again):
Superuser created successfully.
```

#### We must now move the components of our movies app into the `django_admin_app`

We GO inside our:

`./movies/admin.py` directory

```python
from django.contrib import admin
# .models means the models module in our current folder
from .models import Genre, Movie
# Register your models here.
admin.site.register(Genre)
admin.site.register(Movie)
```

We are telling django_admin_app to add Movie and Genre to the admin panel.

** you can manage the website with this panel. Which also means administrate the database. because we added the two models above**

### Customizing the admin

We want to modify the representation of our models (Movie; Genre) inside the admin panel.

Go : `movies/models.py'

```python
from django.db import models
from django.utils import timezone
# Create your models here.


class Genre(models.Model):
    # use field
    name = models.CharField(max_length=255)
    # override the default __str__

    def __str__(self):
        return self.name


class Movie(models.Model):
    # use field
    title = models.CharField(max_length=255)
    release_year = models.IntegerField()
    number_in_stock = models.IntegerField()
    daily_rate = models.FloatField()
    # association has-many and belongs to
    # on delete will tell django how to handle
    # a delete event of a genre given the
    genre = models.ForeignKey(Genre, on_delete=models.CASCADE)
    # add a new
    date_created = models.DateTimeField(default=timezone.now)

```

#### Customize the display of the columns

`movies/admin`:

```python
from django.contrib import admin
# .models means the models module in our current folder
from .models import Genre, Movie

# customize the representation of the models in admin panel


class GenreAdmin(admin.ModelAdmin):
    list_display = ("id", "name")


class MovieAdmin(admin.ModelAdmin):

    list_display = ("title", "number_in_stock", "daily_rate")
    # specify the fields we want or not to show
    exclude = ('date_created', )

    # Register your models here.


admin.site.register(Genre, GenreAdmin)
admin.site.register(Movie, MovieAdmin)
```

Now we have a perfect representation of our data base inside the admin panel. we can nice administrate the website.

**This is not the public area**

### Database Abstraction Area

We want to view a list of movies in our `/movies` routes.

Go: `movies/views.py`

Just like in ruby, we can pass data from our databse with our models class. `(Class.all)` is avalaible.

```python
from django.http import HttpResponse
from django.shortcuts import render
from .models import Movie

# Create your views here.


def index(request):
    movies = Movie.objects.all()
    output = " ".join([m.title for m in movies])
    return HttpResponse(output)

# create a urls.py to mapp this index

```

Npw we must learn to render these logic inside an html. With Templates....

### Templates
